{"version":3,"sources":["../../app-es6/controllers/NegotiationController.js"],"names":["NegotiationController","$","document","querySelector","bind","_data","_quantity","_value","_listNegotiationsViewElement","_listNegotiations","DataBinding","ListNegotiations","_listNegotiationsView","ListNegotiationsView","_sortOrder","_messageViewElement","_message","Message","_messageView","MessageView","_negotiationService","NegotiationsService","_init","listAll","then","negotiations","forEach","negotiation","add","catch","err","content","setTimeout","importNegotiations","event","preventDefault","_createNegotiation","message","_clearForm","removeMessage","delete","clear","import","Negotiation","DateHelper","convertStringToDate","value","Number","focus","target","textContent","toLowerCase","reverse","order","a","b","quantity","data"],"mappings":"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","file":"NegotiationController.js","sourcesContent":["class NegotiationController {\n  constructor() {\n    const $ = document.querySelector.bind(document);\n    this._data = $(\"#data\");\n    this._quantity = $(\"#quantidade\");\n    this._value = $(\"#valor\");\n\n    this._listNegotiationsViewElement = $(\"#negotiationsView\");\n\n    this._listNegotiations = new DataBinding(\n      new ListNegotiations(),\n      (this._listNegotiationsView = new ListNegotiationsView(\n        this._listNegotiationsViewElement\n      )),\n      \"add\",\n      \"clear\",\n      \"order\",\n      \"reverse\"\n    );\n    this._sortOrder = \"\";\n\n    this._messageViewElement = $(\"#messageView\");\n\n    this._message = new DataBinding(\n      new Message(),\n      (this._messageView = new MessageView(this._messageViewElement)),\n      \"content\"\n    );\n\n    this._negotiationService = new NegotiationsService();\n\n    this._init();\n  }\n\n  _init() {\n    this._negotiationService\n      .listAll()\n      .then((negotiations) =>\n        negotiations.forEach((negotiation) =>\n          this._listNegotiations.add(negotiation)\n        )\n      )\n      .catch((err) => (this._message.content = err));\n\n    setTimeout(() => {\n      this.importNegotiations();\n    }, 3000);\n  }\n\n  add(event) {\n    event.preventDefault();\n\n    const negotiation = this._createNegotiation();\n\n    new NegotiationsService()\n      .add(negotiation)\n      .then((message) => {\n        this._listNegotiations.add(negotiation);\n        this._message.content = message;\n        this._clearForm();\n        this._messageView.removeMessage();\n      })\n      .catch((err) => (this._message.content = err));\n  }\n\n  delete() {\n    this._negotiationService\n      .delete()\n      .then((message) => {\n        this._message.content = message;\n        this._listNegotiations.clear();\n      })\n      .catch((err) => (this._message.content = err));\n\n    this._messageView.removeMessage();\n  }\n\n  importNegotiations() {\n    this._negotiationService\n      .import(this._listNegotiations.negotiations)\n      .then((negotiations) => {\n        negotiations.forEach((negotiations) =>\n          negotiations.forEach((negotiation) => {\n            this._listNegotiations.add(negotiation);\n          })\n        );\n      });\n  }\n\n  _createNegotiation() {\n    const negotiation = new Negotiation(\n      DateHelper.convertStringToDate(this._data.value),\n      Number(this._quantity.value),\n      Number(this._value.value)\n    );\n\n    return negotiation;\n  }\n\n  _clearForm() {\n    this._data.value = \"\";\n    this._quantity.value = \"\";\n    this._value.value = \"\";\n\n    this._data.focus();\n  }\n\n  order(event) {\n    const value = event.target.textContent.toLowerCase(); //pega o alvo filho do evento e seu valor\n\n    if (this._sortOrder == value) {\n      this._listNegotiations.reverse();\n    } else {\n      if (value == \"quantidade\") {\n        this._listNegotiations.order((a, b) => a.quantity - b.quantity);\n      } else if (value == \"valor\") {\n        this._listNegotiations.order((a, b) => a.value - b.value);\n      } else {\n        this._listNegotiations.order((a, b) => a.data - b.data);\n      }\n    }\n\n    this._sortOrder = value;\n  }\n}\n"]}